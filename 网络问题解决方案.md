# Docker 网络问题解决方案

## 问题描述

构建 Docker 镜像时出现网络连接错误：
```
failed to fetch anonymous token: dial tcp connectex: A connection attempt failed
```

这是因为无法连接到 Docker Hub 官方镜像源（在国内很常见）。

## 🚀 快速解决方案

### 方案一：使用国内镜像版本（推荐）

我已经为你创建了使用阿里云镜像的版本，直接运行：

```cmd
deploy-cn.bat
```

这个脚本会：
- 使用阿里云的 Node.js 镜像
- 使用淘宝 npm 镜像源
- 自动完成构建和部署

### 方案二：配置 Docker 镜像加速器

1. **打开 Docker Desktop**
2. **进入设置**：点击右上角齿轮图标 → Settings
3. **配置镜像源**：Docker Engine → 添加以下配置：

```json
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://registry.docker-cn.com",
    "https://hub-mirror.c.163.com"
  ]
}
```

4. **应用并重启**：点击 "Apply & Restart"
5. **重新运行**：`deploy.bat`

### 方案三：使用代理

如果你有代理服务器：

1. **Docker Desktop 设置**
2. **Resources → Proxies**
3. **配置代理地址**
4. **应用并重启**

## 📋 推荐使用顺序

1. ✅ **首选**：运行 `deploy-cn.bat`（最简单）
2. ⚙️ **备选**：配置 Docker 镜像加速器
3. 🔧 **高级**：使用代理服务器

## 🎯 验证是否成功

运行以下命令测试：

```cmd
# 测试能否拉取镜像
docker pull registry.cn-hangzhou.aliyuncs.com/library/node:20-alpine

# 如果成功，继续部署
deploy-cn.bat
```

## 📊 各方案对比

| 方案 | 难度 | 速度 | 稳定性 | 推荐度 |
|------|------|------|--------|--------|
| deploy-cn.bat | ⭐ 简单 | ⚡ 快 | ✅ 高 | ⭐⭐⭐⭐⭐ |
| 镜像加速器 | ⭐⭐ 中等 | ⚡ 快 | ✅ 高 | ⭐⭐⭐⭐ |
| 代理服务器 | ⭐⭐⭐ 复杂 | 🐌 慢 | ⚠️ 中 | ⭐⭐ |

## 🔍 常见问题

### Q: deploy-cn.bat 还是失败怎么办？
**A**: 尝试以下步骤：
1. 重启 Docker Desktop
2. 检查网络连接
3. 尝试配置镜像加速器（方案二）

### Q: 如何确认使用了国内镜像？
**A**: 查看 `Dockerfile.cn` 文件，第一行应该是：
```dockerfile
FROM registry.cn-hangzhou.aliyuncs.com/library/node:20-alpine
```

### Q: 构建很慢怎么办？
**A**: 
- 确保使用 `deploy-cn.bat`
- 检查网络连接
- 第一次构建会慢一些，后续会使用缓存

### Q: 能否同时配置多个镜像源？
**A**: 可以，在 Docker Engine 配置中添加多个镜像源，Docker 会自动选择最快的。

## 📚 相关资源

- 阿里云镜像服务：https://cr.console.aliyun.com/
- Docker 官方文档：https://docs.docker.com/
- 中科大镜像站：https://mirrors.ustc.edu.cn/

## 💡 下一步

1. ✅ 运行 `deploy-cn.bat`
2. ✅ 等待构建完成（首次约 2-5 分钟）
3. ✅ 访问 http://localhost:3000
4. ✅ 开始使用！

---

**提示**：如果所有方案都失败，可能是网络环境限制，建议联系网络管理员或使用其他网络环境。
